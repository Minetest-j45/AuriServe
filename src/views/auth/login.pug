doctype html
html(lang="en")
	head
		include ../includes/head.pug
		title Log In &bullet; Admin Panel

	body.center_wrap
		form#login_card(method="post")
			.profile_placeholder
			input(type="text", name="user", placeholder="Username", autofocus, required, minlength="3", maxlength="32")
			input(type="password", name="pass", placeholder="Password", required, minlength="8")
			button Log In
		
		p.warning#warning

		script.
			const form = document.getElementById("login_card");
			const err = document.getElementById("warning");
	
			let reqSent = false;
			form.addEventListener('submit', e => {
				
				if (!reqSent) {
					reqSent = true;
					err.innerText = "";

					const xhr = new XMLHttpRequest();
					xhr.open("POST", "/admin/auth", true);
					xhr.setRequestHeader('Content-Type', 'application/json');

					xhr.onload = function() {
						reqSent = false;
						if (xhr.status != 200) {
							err.innerText = this.responseText;
						}
						else {
							Cookies.set('tkn', this.responseText, { expires: 3 });
							location.href = "/admin/";
						}
					}

					xhr.send(JSON.stringify({ 
						user: form.querySelector("input[name=user]").value, 
						pass: form.querySelector("input[name=pass]").value 
					}));
				}

				e.preventDefault();
				return false;
			});
